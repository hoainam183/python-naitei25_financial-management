{% load i18n static %}

<!-- Messages -->
{% if messages %}
    <div class="mb-6">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} p-4 rounded-lg mb-4 {% if message.tags == 'success' %}bg-green-100 border border-green-300 text-green-800{% elif message.tags == 'error' %}bg-red-100 border border-red-300 text-red-800{% elif message.tags == 'info' %}bg-blue-100 border border-blue-300 text-blue-800{% else %}bg-gray-100 border border-gray-300 text-gray-800{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}
<div class="p-2">
    <!-- Header -->
    <div class="border-b border-gray-200 pb-5 mb-6">
        <h3 class="text-2xl font-semibold leading-6 text-gray-900 ml-4 mt-2">
            {% if is_edit_mode %}
                {% trans "Chỉnh sửa thông tin cá nhân" %}
            {% else %}
                {% trans "Thông tin cá nhân" %}
            {% endif %}
        </h3>
        <p class="mt-2 max-w-4xl text-sm text-gray-500 ml-4">
            {% if is_edit_mode %}
                {% trans "Cập nhật thông tin cá nhân của bạn." %}
            {% else %}
                {% trans "Xem thông tin chi tiết về tài khoản của bạn." %}
            {% endif %}
        </p>
    </div>

    <!-- Profile Card -->
    <div class="bg-white shadow-sm rounded-lg border border-gray-200">
        {% if is_edit_mode %}
            <!-- Edit Form -->
            <form method="post" id="profileForm">
                {% csrf_token %}
                <div class="px-6 py-8">
                    <!-- Avatar và tên -->
                    <div class="flex items-center mb-8">
                        <div class="h-20 w-20 rounded-full bg-gradient-to-r {{ colors.gradient }} flex items-center justify-center text-white text-2xl font-bold">
                            {{ user.full_name|first|upper }}
                        </div>
                        <div class="ml-6">
                            <h1 class="text-2xl font-bold text-gray-900">{{ user.full_name }}</h1>
                            <p class="text-sm text-gray-500 flex items-center mt-1">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ colors.badge }}">
                                    {{ role_name|title }}
                                </span>
                            </p>
                        </div>
                    </div>

                    <!-- Form Fields -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Email -->
                        <div class="space-y-1">
                            <label for="{{ form.email.id_for_label }}" class="text-sm font-medium text-gray-500">
                                {% trans "Email" %} <span class="text-red-500">*</span>
                            </label>
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                                <div class="flex-1">
                                    {{ form.email }}
                                    {% if form.email.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Phone -->
                        <div class="space-y-1">
                            <label for="{{ form.phone.id_for_label }}" class="text-sm font-medium text-gray-500">
                                {% trans "Số điện thoại" %} <span class="text-red-500">*</span>
                            </label>
                            <div class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                </svg>
                                <div class="flex-1">
                                    {{ form.phone }}
                                    {% if form.phone.errors %}
                                        <p class="mt-1 text-sm text-red-600">{{ form.phone.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Read-only fields -->
                        <!-- Địa chỉ (read-only) -->
                        <div class="space-y-1 md:col-span-2">
                            <dt class="text-sm font-medium text-gray-500">{% trans "Địa chỉ" %}</dt>
                            <dd class="text-sm text-gray-900 flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span>{{ full_address }}</span>
                            </dd>
                        </div>

                        <!-- Ngày tham gia (read-only) -->
                        <div class="space-y-1">
                            <dt class="text-sm font-medium text-gray-500">{% trans "Ngày tham gia" %}</dt>
                            <dd class="text-sm text-gray-900 flex items-center">
                                <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                {{ user.date_joined|date:"d/m/Y H:i" }}
                            </dd>
                        </div>

                        <!-- Trạng thái (read-only) -->
                        <div class="space-y-1">
                            <dt class="text-sm font-medium text-gray-500">{% trans "Trạng thái" %}</dt>
                            <dd class="text-sm text-gray-900 flex items-center">
                                {% if user.is_active %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        {% trans "Đang hoạt động" %}
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                        </svg>
                                        {% trans "Đã vô hiệu hóa" %}
                                    </span>
                                {% endif %}
                            </dd>
                        </div>
                    </div>

                    <!-- Action buttons for edit mode -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <div class="flex flex-col sm:flex-row gap-3">
                            <!-- Save button -->
                            <button type="submit" class="inline-flex items-center justify-center px-4 py-2 bg-blue-600 border border-transparent text-sm font-medium rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-200">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                {% trans "Lưu thông tin" %}
                            </button>
                            
                            <!-- Cancel button -->
                            <button type="button" id="cancelBtn" class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition duration-200">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                                {% trans "Hủy" %}
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        {% else %}
            <!-- View Mode -->
            <div class="px-6 py-8">
                <!-- Avatar và tên -->
                <div class="flex items-center mb-8">
                    <div class="h-20 w-20 rounded-full bg-gradient-to-r {{ colors.gradient }} flex items-center justify-center text-white text-2xl font-bold">
                        {{ user.full_name|first|upper }}
                    </div>
                    <div class="ml-6">
                        <h1 class="text-2xl font-bold text-gray-900">{{ user.full_name }}</h1>
                        <p class="text-sm text-gray-500 flex items-center mt-1">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ colors.badge }}">
                                {{ role_name|title }}
                            </span>
                        </p>
                    </div>
                </div>

                <!-- Thông tin chi tiết -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Email -->
                    <div class="space-y-1">
                        <dt class="text-sm font-medium text-gray-500">{% trans "Email" %}</dt>
                        <dd class="text-sm text-gray-900 flex items-center">
                            <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            {{ user.email }}
                        </dd>
                    </div>

                    <!-- Số điện thoại -->
                    <div class="space-y-1">
                        <dt class="text-sm font-medium text-gray-500">{% trans "Số điện thoại" %}</dt>
                        <dd class="text-sm text-gray-900 flex items-center">
                            <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                            {{ user.phone|default:_("Chưa cập nhật") }}
                        </dd>
                    </div>

                    <!-- Địa chỉ -->
                    <div class="space-y-1 md:col-span-2">
                        <dt class="text-sm font-medium text-gray-500">{% trans "Địa chỉ" %}</dt>
                        <dd class="text-sm text-gray-900 flex items-start">
                            <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span>{{ full_address }}</span>
                        </dd>
                    </div>

                    <!-- Thời gian tham gia -->
                    <div class="space-y-1">
                        <dt class="text-sm font-medium text-gray-500">{% trans "Ngày tham gia" %}</dt>
                        <dd class="text-sm text-gray-900 flex items-center">
                            <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            {{ user.date_joined|date:"d/m/Y H:i" }}
                        </dd>
                    </div>

                    <!-- Trạng thái tài khoản -->
                    <div class="space-y-1">
                        <dt class="text-sm font-medium text-gray-500">{% trans "Trạng thái" %}</dt>
                        <dd class="text-sm text-gray-900 flex items-center">
                            {% if user.is_active %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    {% trans "Đang hoạt động" %}
                                </span>
                            {% else %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                    {% trans "Đã vô hiệu hóa" %}
                                </span>
                            {% endif %}
                        </dd>
                    </div>
                </div>

                <!-- Action buttons for view mode -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <div class="flex flex-col sm:flex-row gap-3">
                        <!-- Edit button -->
                        <a href="{% url 'profile_edit' %}" class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 {{ colors.focus_ring }} transition duration-200">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                            {% trans "Chỉnh sửa thông tin" %}
                        </a>
                    </div>
                    
                    <!-- Thông tin bổ sung theo role -->
                    <div class="mt-6 p-4 {{ colors.info_bg }} rounded-lg">
                        <div class="flex">
                            {% if role_name|lower == 'role_resident' %}
                                <svg class="w-5 h-5 {{ colors.info_icon }} mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            {% elif role_name|lower == 'role_apartment_manager' %}
                                <svg class="w-5 h-5 {{ colors.info_icon }} mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            {% else %}
                                <svg class="w-5 h-5 {{ colors.info_icon }} mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                            {% endif %}
                            <div class="ml-3">
                                <h3 class="text-sm font-medium {{ colors.info_text }}">
                                    {% if role_name|lower == 'role_resident' %}
                                        {% trans "Lưu ý" %}
                                    {% elif role_name|lower == 'role_apartment_manager' %}
                                        {% trans "Quyền quản lý" %}
                                    {% else %}
                                        {% trans "Quyền quản trị" %}
                                    {% endif %}
                                </h3>
                                <div class="mt-2 text-sm {{ colors.info_content }}">
                                    {% if role_name|lower == 'role_resident' %}
                                        <p>{% trans "Bạn có thể cập nhật thông tin cá nhân và thay đổi mật khẩu bất kỳ lúc nào. Vui lòng giữ thông tin liên hệ luôn chính xác để nhận thông báo quan trọng." %}</p>
                                    {% elif role_name|lower == 'role_apartment_manager' %}
                                        <p>{% trans "Bạn có quyền quản lý hệ thống và cư dân. Vui lòng giữ thông tin liên hệ luôn chính xác để thực hiện các nhiệm vụ quản lý hiệu quả." %}</p>
                                    {% else %}
                                        <p>{% trans "Bạn có quyền quản trị toàn hệ thống với mức độ truy cập cao nhất. Vui lòng bảo mật thông tin tài khoản và sử dụng quyền hạn một cách có trách nhiệm." %}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- Confirm Dialog Modal -->
    <div id="confirmModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100">
                    <svg class="h-6 w-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">{% trans "Xác nhận hủy" %}</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">{% trans "Bạn có chắc chắn muốn hủy chỉnh sửa? Tất cả thay đổi chưa lưu sẽ bị mất." %}</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="confirmCancel" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-24 mr-2 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300">
                        {% trans "Có" %}
                    </button>
                    <button id="cancelCancel" class="px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md w-24 hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300">
                        {% trans "Không" %}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Include profile styles -->
<link rel="stylesheet" href="{% static 'css/profile.css' %}">

<!-- Include profile JavaScript -->
<script>
    // Pass Django template variables to JavaScript
    window.profileConfig = {
        profileUrl: "{% url 'profile' %}",
        emailFieldId: "{{ form.email.id_for_label|default:'' }}",
        phoneFieldId: "{{ form.phone.id_for_label|default:'' }}",
        messages: {
            emailRequired: "{% trans 'Email là bắt buộc.' %}",
            emailInvalid: "{% trans 'Vui lòng nhập email hợp lệ.' %}",
            phoneRequired: "{% trans 'Số điện thoại là bắt buộc.' %}",
            phoneInvalid: "{% trans 'Số điện thoại không hợp lệ.' %}"
        }
    };
</script>
<script src="{% static 'js/profile.js' %}"></script>
